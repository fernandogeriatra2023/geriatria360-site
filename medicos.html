<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Área Médica — Geriatria 360</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #2c5aa0;
      --primary-light: #4a7bc8;
      --secondary: #34a38a;
      --accent: #ff7b54;
      --danger: #e74c3c;
      --warning: #f39c12;
      --success: #27ae60;
      --light: #f8f9fa;
      --dark: #343a40;
      --gray: #6c757d;
      --gray-light: #e9ecef;
      --border-radius: 10px;
      --box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
      --transition: all 0.3s ease;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      line-height: 1.6;
      color: var(--dark);
      background-color: #f5f7fa;
    }
    
    .container {
      width: 100%;
      max-width: 1400px;
      margin: 0 auto;
      padding: 0 20px;
    }
    
    .medical-header {
      background: white;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      position: sticky;
      top: 0;
      z-index: 1000;
    }
    
    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 0;
    }
    
    .medical-brand {
      display: flex;
      align-items: center;
      gap: 10px;
      text-decoration: none;
      color: var(--primary);
      font-weight: 700;
      font-size: 1.5rem;
    }
    
    .medical-nav {
      display: flex;
      gap: 20px;
      align-items: center;
    }
    
    .medical-nav a {
      text-decoration: none;
      color: var(--dark);
      font-weight: 500;
      transition: var(--transition);
    }
    
    .medical-user {
      display: flex;
      align-items: center;
      gap: 10px;
      color: var(--gray);
    }
    
    .medical-user img {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      object-fit: cover;
    }
    
    .login-container {
      max-width: 500px;
      margin: 80px auto;
      background: white;
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      padding: 40px;
    }
    
    .login-header {
      text-align: center;
      margin-bottom: 30px;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
    }
    
    .form-control {
      width: 100%;
      padding: 12px 15px;
      border: 1px solid var(--gray-light);
      border-radius: var(--border-radius);
      font-size: 1rem;
      transition: var(--transition);
    }
    
    .form-control:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(44, 90, 160, 0.1);
    }
    
    .btn {
      display: inline-block;
      padding: 12px 25px;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: var(--border-radius);
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      text-decoration: none;
    }
    
    .btn:hover {
      background: var(--primary-light);
      transform: translateY(-2px);
    }
    
    .btn-block {
      display: block;
      width: 100%;
    }
    
    .btn-success {
      background: var(--success);
    }
    
    .btn-success:hover {
      background: #219653;
    }
    
    .medical-main {
      display: none;
      padding: 30px 0;
    }
    
    .medical-dashboard {
      display: grid;
      grid-template-columns: 300px 1fr;
      gap: 30px;
    }
    
    .medical-sidebar {
      background: white;
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      padding: 25px;
      height: fit-content;
      position: sticky;
      top: 90px;
    }
    
    .patient-info {
      text-align: center;
      padding-bottom: 20px;
      border-bottom: 1px solid var(--gray-light);
      margin-bottom: 20px;
    }
    
    .patient-avatar {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      object-fit: cover;
      margin: 0 auto 15px;
      border: 3px solid var(--primary-light);
    }
    
    .patient-details {
      margin-bottom: 25px;
    }
    
    .detail-item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
      padding-bottom: 10px;
      border-bottom: 1px solid var(--gray-light);
    }
    
    .detail-label {
      font-weight: 500;
    }
    
    .detail-value {
      color: var(--gray);
    }
    
    .medical-tabs {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    
    .medical-tab {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 15px;
      border-radius: var(--border-radius);
      cursor: pointer;
      transition: var(--transition);
      text-decoration: none;
      color: var(--dark);
    }
    
    .medical-tab:hover {
      background: var(--gray-light);
    }
    
    .medical-tab.active {
      background: var(--primary);
      color: white;
    }
    
    .medical-content {
      background: white;
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      padding: 30px;
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
    
    .tab-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
      padding-bottom: 15px;
      border-bottom: 1px solid var(--gray-light);
    }
    
    .cid-search-container {
      position: relative;
      margin-bottom: 20px;
    }
    
    .cid-results {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: white;
      border: 1px solid var(--gray-light);
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      max-height: 200px;
      overflow-y: auto;
      z-index: 10;
      display: none;
    }
    
    .cid-result {
      padding: 10px 15px;
      cursor: pointer;
      border-bottom: 1px solid var(--gray-light);
    }
    
    .cid-result:hover {
      background: var(--gray-light);
    }
    
    .cid-chips {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 20px;
    }
    
    .cid-chip {
      display: flex;
      align-items: center;
      gap: 8px;
      background: var(--primary-light);
      color: white;
      padding: 5px 12px;
      border-radius: 20px;
      font-size: 0.9rem;
    }
    
    .cid-chip button {
      background: none;
      border: none;
      color: white;
      cursor: pointer;
      font-size: 0.8rem;
    }
    
    .editor-toolbar {
      display: flex;
      gap: 5px;
      padding: 10px;
      background: var(--gray-light);
      border-radius: var(--border-radius) var(--border-radius) 0 0;
    }
    
    .medical-editor {
      width: 100%;
      min-height: 300px;
      padding: 15px;
      border: 1px solid var(--gray-light);
      border-top: none;
      border-radius: 0 0 var(--border-radius) var(--border-radius);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      font-size: 1rem;
      resize: vertical;
    }
    
    .medication-form {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr auto;
      gap: 15px;
      margin-bottom: 20px;
    }
    
    .medication-list {
      border: 1px solid var(--gray-light);
      border-radius: var(--border-radius);
      overflow: hidden;
    }
    
    .medication-item {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr auto;
      gap: 15px;
      padding: 15px;
      border-bottom: 1px solid var(--gray-light);
      align-items: center;
    }
    
    .medication-item:last-child {
      border-bottom: none;
    }
    
    .medication-actions {
      display: flex;
      gap: 10px;
    }
    
    .medication-actions button {
      background: none;
      border: none;
      cursor: pointer;
      color: var(--gray);
      transition: var(--transition);
    }
    
    .calendar-container {
      background: white;
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      overflow: hidden;
      margin-bottom: 30px;
    }
    
    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px;
      background: var(--primary);
      color: white;
    }
    
    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
    }
    
    .calendar-day {
      padding: 10px;
      text-align: center;
      font-weight: 600;
      background: var(--gray-light);
    }
    
    .calendar-dates {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      grid-auto-rows: 60px;
    }
    
    .calendar-date {
      padding: 10px;
      text-align: center;
      border: 1px solid var(--gray-light);
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .calendar-date.today {
      background: var(--primary-light);
      color: white;
    }
    
    .appointment-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px;
      border: 1px solid var(--gray-light);
      border-radius: var(--border-radius);
      margin-bottom: 15px;
    }
    
    .appointment-status {
      padding: 5px 10px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 600;
    }
    
    .status-scheduled {
      background: #e8f4fd;
      color: var(--primary);
    }
    
    .status-confirmed {
      background: #e6f4ea;
      color: var(--success);
    }
    
    .documents-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
    }
    
    .document-card {
      background: var(--light);
      border-radius: var(--border-radius);
      padding: 20px;
      transition: var(--transition);
    }
    
    .document-card:hover {
      transform: translateY(-5px);
      box-shadow: var(--box-shadow);
    }
    
    .document-icon {
      width: 60px;
      height: 60px;
      background: var(--primary);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 1.5rem;
      margin-bottom: 15px;
    }
    
    .alert {
      padding: 15px;
      border-radius: var(--border-radius);
      margin-bottom: 20px;
    }
    
    .alert-error {
      background: #fde8e6;
      color: var(--danger);
      border: 1px solid #f5b4ab;
    }

    .alert-success {
      background: #e6f4ea;
      color: var(--success);
      border: 1px solid #c8e6c9;
    }
    
    /* Estilos para atestados */
    .cert-field-group {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin-bottom: 15px;
    }
    
    .cert-field-full {
      grid-column: 1 / -1;
    }

    /* Estilo para o card de finalização */
    .finalization-card {
      margin-top: 30px;
      background: #e8f5e8;
      border-left: 4px solid var(--success);
      padding: 20px;
      border-radius: var(--border-radius);
    }

    .debug-panel {
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: var(--border-radius);
      padding: 15px;
      margin-top: 20px;
      font-family: monospace;
      font-size: 0.8rem;
    }
    
    /* NOVOS ESTILOS PARA AGENDAMENTOS DO DIA */
    .agendamentos-dia-container {
      background: white;
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      padding: 25px;
      margin-bottom: 30px;
    }
    
    .agendamentos-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .agendamentos-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
    }
    
    .agendamento-card {
      background: var(--light);
      border-radius: var(--border-radius);
      padding: 20px;
      border-left: 4px solid var(--primary);
      transition: var(--transition);
    }
    
    .agendamento-card:hover {
      transform: translateY(-3px);
      box-shadow: var(--box-shadow);
    }
    
    .agendamento-card.prioridade-alta {
      border-left-color: var(--danger);
    }
    
    .agendamento-card.prioridade-media {
      border-left-color: var(--warning);
    }
    
    .agendamento-card.prioridade-baixa {
      border-left-color: var(--success);
    }
    
    .agendamento-actions {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }
    
    .agendamento-actions .btn {
      padding: 8px 15px;
      font-size: 0.9rem;
    }
    
    .badge {
      display: inline-block;
      padding: 5px 10px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 600;
    }
    
    .badge-primary {
      background: var(--primary-light);
      color: white;
    }
    
    .badge-warning {
      background: var(--warning);
      color: white;
    }
    
    .badge-success {
      background: var(--success);
      color: white;
    }
    
    .badge-danger {
      background: var(--danger);
      color: white;
    }
    
    .empty-state {
      text-align: center;
      padding: 40px 20px;
      color: var(--gray);
    }
    
    .empty-state i {
      font-size: 3rem;
      margin-bottom: 15px;
      color: var(--gray-light);
    }
    
    .no-patient-alert {
      background: #fff3cd;
      border: 1px solid #ffeaa7;
      color: #856404;
      padding: 15px;
      border-radius: var(--border-radius);
      margin-bottom: 20px;
      text-align: center;
    }
    
    @media (max-width: 1200px) {
      .medical-dashboard {
        grid-template-columns: 1fr;
      }
      
      .medical-sidebar {
        position: static;
      }
    }
    
    @media (max-width: 768px) {
      .medical-nav {
        display: none;
      }
      
      .medication-form {
        grid-template-columns: 1fr;
      }
      
      .medication-item {
        grid-template-columns: 1fr;
        gap: 10px;
      }
      
      .documents-grid {
        grid-template-columns: 1fr;
      }
      
      .cert-field-group {
        grid-template-columns: 1fr;
      }
      
      .agendamentos-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <header class="medical-header">
    <div class="container">
      <div class="header-content">
        <a href="login-geral.html" class="medical-brand">
          <i class="fas fa-heartbeat"></i>
          <span>Geriatria 360 - Área Médica</span>
        </a>
        
        <nav class="medical-nav">
          <a href="login-geral.html"><i class="fas fa-home"></i> Início</a>
          <a href="recepcao.html"><i class="fas fa-user-injured"></i> Recepção</a>
          <a href="triagem.html"><i class="fas fa-stethoscope"></i> Triagem</a>
        </nav>
        
        <div class="medical-user">
          <img src="https://ui-avatars.com/api/?name=Dr+Silva&background=2c5aa0&color=fff" alt="Dr. Silva">
          <div>
            <div id="currentDoctorName">Dr. Silva</div>
            <small>Geriatra</small>
          </div>
          <button onclick="sairMedico()" class="btn" style="background: #e74c3c; margin-left: 10px; padding: 8px 15px;">
            <i class="fas fa-sign-out-alt"></i> Sair
          </button>
        </div>
      </div>
    </div>
  </header>

  <!-- Tela de login interna (para acesso direto) -->
  <section id="loginArea" class="login-container">
    <div class="login-header">
      <h1>Área Médica</h1>
      <p>Acesso restrito a profissionais de saúde</p>
    </div>
    
    <form id="loginForm">
      <div class="form-group">
        <label for="med-user">Usuário</label>
        <input type="text" id="med-user" class="form-control" placeholder="Digite seu usuário">
      </div>
      
      <div class="form-group">
        <label for="med-pass">Senha</label>
        <input type="password" id="med-pass" class="form-control" placeholder="Digite sua senha">
      </div>
      
      <button type="button" class="btn btn-block" onclick="loginMed()">Entrar na Área Médica</button>
    </form>
    
    <div class="alert alert-error" id="loginError" style="display: none;">
      Usuário ou senha incorretos. Tente novamente.
    </div>

    <div style="text-align: center; margin-top: 20px;">
      <a href="login-geral.html" class="btn" style="background: var(--secondary);">
        <i class="fas fa-arrow-left"></i> Voltar para Login Geral
      </a>
    </div>

    <div style="text-align: center; margin-top: 20px; padding: 15px; background: #e8f4fd; border-radius: var(--border-radius);">
      <p><strong>Credenciais de Teste:</strong></p>
      <p>Usuário: <strong>medico</strong></p>
      <p>Senha: <strong>medico123</strong></p>
    </div>
  </section>

  <!-- Área médica principal -->
  <section id="medicalArea" class="medical-main">
    <div class="container">
      <div class="medical-dashboard">
        <aside class="medical-sidebar">
          <div class="patient-info">
            <img src="https://ui-avatars.com/api/?name=Médico&background=2c5aa0&color=fff" alt="Médico" class="patient-avatar">
            <h3 id="medicName">Dr. Silva</h3>
            <p>CRM: <strong>123456</strong></p>
          </div>
          
          <div class="patient-details">
            <div class="detail-item">
              <span class="detail-label">Agendamentos Hoje</span>
              <span class="detail-value" id="agendamentosCount">0</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Em Atendimento</span>
              <span class="detail-value" id="atendimentosCount">0</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Finalizados</span>
              <span class="detail-value" id="finalizadosCount">0</span>
            </div>
          </div>
          
          <div class="medical-tabs">
            <a href="#" class="medical-tab active" data-tab="dashboard">
              <i class="fas fa-home"></i>
              <span>Dashboard</span>
            </a>
            <a href="#" class="medical-tab" data-tab="evolucao">
              <i class="fas fa-stethoscope"></i>
              <span>Evolução Médica</span>
            </a>
            <a href="#" class="medical-tab" data-tab="medicacao">
              <i class="fas fa-pills"></i>
              <span>Medicação</span>
            </a>
            <a href="#" class="medical-tab" data-tab="atestados">
              <i class="fas fa-file-medical"></i>
              <span>Atestados</span>
            </a>
            <a href="#" class="medical-tab" data-tab="documentos">
              <i class="fas fa-file-contract"></i>
              <span>Documentos</span>
            </a>
            <a href="#" class="medical-tab" data-tab="agendamento">
              <i class="fas fa-calendar-check"></i>
              <span>Agendamento</span>
            </a>
            <a href="#" class="medical-tab" data-tab="exames">
              <i class="fas fa-vial"></i>
              <span>Solicitar Exames</span>
            </a>
          </div>
        </aside>
        
        <main class="medical-content">
          <!-- Dashboard -->
          <div id="dashboard" class="tab-content active">
            <div class="tab-header">
              <h2>Dashboard Médico</h2>
              <div class="tab-actions">
                <button class="btn" onclick="carregarAgendamentosDoDia()">
                  <i class="fas fa-sync-alt"></i> Atualizar
                </button>
                <button class="btn btn-success" onclick="criarDadosDemonstracao()">
                  <i class="fas fa-plus"></i> Criar Dados de Teste
                </button>
                <button class="btn" onclick="testarIntegracao()">
                  <i class="fas fa-vial"></i> Testar Integração
                </button>
              </div>
            </div>
            
            <div class="agendamentos-dia-container">
              <div class="agendamentos-header">
                <h3><i class="fas fa-calendar-day"></i> Agendamentos de Hoje</h3>
                <span class="badge badge-primary" id="totalAgendamentosHoje">0 agendamentos</span>
              </div>
              
              <div id="agendamentosDoDia" class="agendamentos-grid">
                <!-- Agendamentos serão carregados aqui -->
              </div>
            </div>
            
            <div class="agendamentos-dia-container">
              <div class="agendamentos-header">
                <h3><i class="fas fa-user-injured"></i> Pacientes em Atendimento</h3>
                <span class="badge badge-warning" id="totalAtendimentos">0 pacientes</span>
              </div>
              
              <div id="pacientesAtendimento" class="agendamentos-grid">
                <!-- Pacientes em atendimento serão carregados aqui -->
              </div>
            </div>
          </div>
          
          <!-- Evolução Médica -->
          <div id="evolucao" class="tab-content">
            <div class="tab-header">
              <h2>Evolução Médica</h2>
              <div class="tab-actions">
                <button class="btn" onclick="saveEvolution()"><i class="fas fa-save"></i> Salvar</button>
                <button class="btn btn-success" onclick="generateAIReport()"><i class="fas fa-robot"></i> Gerar Laudo IA</button>
              </div>
            </div>
            
            <div id="pacienteInfoEvolucao" style="background: #e8f4fd; padding: 15px; border-radius: var(--border-radius); margin-bottom: 20px; display: none;">
              <h4 id="nomePacienteEvolucao"></h4>
              <p id="detalhesPacienteEvolucao"></p>
            </div>
            
            <div class="alert alert-error" id="alertNoPatient" style="display: none;">
              <i class="fas fa-exclamation-triangle"></i> Nenhum paciente selecionado. Selecione um paciente na aba "Dashboard" para iniciar o atendimento.
            </div>
            
            <div class="cid-search-container">
              <input type="text" id="cidSearch" class="form-control" placeholder="Digite código CID-10 (ex: I10) ou descrição...">
              <div id="cidResults" class="cid-results"></div>
            </div>
            
            <div id="cidChips" class="cid-chips"></div>
            
            <div class="editor-container">
              <div class="editor-toolbar">
                <button type="button" title="Negrito" onclick="formatText('bold')"><i class="fas fa-bold"></i></button>
                <button type="button" title="Itálico" onclick="formatText('italic')"><i class="fas fa-italic"></i></button>
                <button type="button" title="Sublinhado" onclick="formatText('underline')"><i class="fas fa-underline"></i></button>
                <button type="button" title="Lista" onclick="formatText('insertUnorderedList')"><i class="fas fa-list-ul"></i></button>
                <button type="button" title="Lista Numerada" onclick="formatText('insertOrderedList')"><i class="fas fa-list-ol"></i></button>
              </div>
              <div id="evolText" class="medical-editor" contenteditable="true">
                <p><strong>Queixa Principal:</strong> </p>
                <p><strong>História da Doença Atual:</strong> </p>
                <p><strong>Exame Físico:</strong> </p>
                <p><strong>Conduta:</strong> </p>
              </div>
            </div>
            
            <!-- Finalizar Atendimento -->
            <div class="finalization-card" id="finalizationCard" style="display: none;">
              <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                  <h3 style="color: var(--success); margin-bottom: 5px;">
                    <i class="fas fa-check-circle"></i> Finalizar Atendimento
                  </h3>
                  <p style="color: var(--gray); margin: 0;" id="statusPaciente">
                    Pronto para finalizar atendimento
                  </p>
                </div>
                <button class="btn btn-success" onclick="finalizarAtendimento()" style="font-size: 1.1rem;">
                  <i class="fas fa-flag-checkered"></i> Finalizar Atendimento
                </button>
              </div>
            </div>
          </div>
          
          <!-- Medicação -->
          <div id="medicacao" class="tab-content">
            <div class="tab-header">
              <h2>Prescrição de Medicação</h2>
              <div class="tab-actions">
                <button class="btn" onclick="savePrescription()"><i class="fas fa-save"></i> Salvar Receita</button>
                <button class="btn" onclick="printPrescription()"><i class="fas fa-print"></i> Imprimir</button>
              </div>
            </div>
            
            <div id="alertNoPatientMedicacao" class="no-patient-alert" style="display: none;">
              <i class="fas fa-exclamation-triangle"></i> Nenhum paciente selecionado. Selecione um paciente na aba "Dashboard" para prescrever medicamentos.
            </div>
            
            <div id="medicacaoContent">
              <div class="medication-container">
                <div class="medication-form">
                  <input type="text" id="medName" class="form-control" placeholder="Medicamento" list="medSuggestions">
                  <datalist id="medSuggestions">
                    <option value="Losartana 50mg">
                    <option value="AAS 100mg">
                    <option value="Sinvastatina 20mg">
                    <option value="Metformina 850mg">
                    <option value="Omeprazol 20mg">
                    <option value="Clopidogrel 75mg">
                    <option value="Atenolol 50mg">
                    <option value="Hidroclorotiazida 25mg">
                  </datalist>
                  <input type="text" id="medDosage" class="form-control" placeholder="Posologia (ex: 1x ao dia)">
                  <input type="text" id="medDuration" class="form-control" placeholder="Duração (ex: 30 dias)">
                  <button type="button" class="btn" onclick="addMedication()"><i class="fas fa-plus"></i> Adicionar</button>
                </div>
                
                <div class="medication-list" id="medicationListContainer">
                  <!-- Medicamentos aparecerão aqui -->
                </div>
              </div>
            </div>
          </div>
          
          <!-- Atestados -->
          <div id="atestados" class="tab-content">
            <div class="tab-header">
              <h2>Emitir Atestados</h2>
              <div class="tab-actions">
                <button class="btn" onclick="saveCertificate()"><i class="fas fa-save"></i> Salvar</button>
                <button class="btn" onclick="printCertificate()"><i class="fas fa-print"></i> Imprimir</button>
              </div>
            </div>
            
            <div id="alertNoPatientAtestado" class="no-patient-alert" style="display: none;">
              <i class="fas fa-exclamation-triangle"></i> Nenhum paciente selecionado. Selecione um paciente na aba "Dashboard" para emitir atestados.
            </div>
            
            <div id="atestadosContent">
              <div class="form-group">
                <label for="certModel">Modelo de Atestado</label>
                <select id="certModel" class="form-control" onchange="changeCertModel(this.value)">
                  <option value="">Selecione um modelo</option>
                  <option value="modelo1">Modelo 1 - Afastamento</option>
                  <option value="modelo2">Modelo 2 - Aptidão Física</option>
                  <option value="modelo3">Modelo 3 - Comparecimento</option>
                  <option value="modelo4">Modelo 4 - Acompanhante</option>
                </select>
              </div>

              <div id="certFields">
                <!-- Campos dinâmicos aparecem aqui -->
              </div>

              <div class="form-group">
                <label for="cidSearchAtestado">CID-10 (opcional)</label>
                <div class="cid-search-container">
                  <input type="text" id="cidSearchAtestado" class="form-control" placeholder="Digite código CID-10 ou descrição...">
                  <div id="cidResultsAtestado" class="cid-results"></div>
                </div>
                <div id="cidChipsAtestado" class="cid-chips"></div>
              </div>

              <div class="form-group">
                <label for="certReason">Texto do Atestado</label>
                <textarea id="certReason" class="form-control" rows="8" placeholder="O texto do atestado será preenchido automaticamente..."></textarea>
              </div>
            </div>
          </div>
          
          <!-- Documentos -->
          <div id="documentos" class="tab-content">
            <div class="tab-header">
              <h2>Documentos Médicos</h2>
              <div class="tab-actions">
                <button class="btn" onclick="newDocument()"><i class="fas fa-plus"></i> Novo Documento</button>
              </div>
            </div>
            
            <div class="documents-grid">
              <div class="document-card">
                <div class="document-icon">
                  <i class="fas fa-file-prescription"></i>
                </div>
                <h3>Receituário</h3>
                <p>Prescrição de medicamentos controlados e simples</p>
                <button class="btn" onclick="openDocument('receita')">Abrir</button>
              </div>
              
              <div class="document-card">
                <div class="document-icon">
                  <i class="fas fa-file-medical-alt"></i>
                </div>
                <h3>Solicitação de Exames</h3>
                <p>Solicitação de exames laboratoriais e de imagem</p>
                <button class="btn" onclick="openDocument('exames')">Abrir</button>
              </div>
              
              <div class="document-card">
                <div class="document-icon">
                  <i class="fas fa-ambulance"></i>
                </div>
                <h3>Encaminhamento</h3>
                <p>Encaminhamento para especialistas ou serviços de saúde</p>
                <button class="btn" onclick="openDocument('encaminhamento')">Abrir</button>
              </div>
              
              <div class="document-card">
                <div class="document-icon">
                  <i class="fas fa-procedures"></i>
                </div>
                <h3>Relatório de Internação</h3>
                <p>Relatório médico para processos de internação</p>
                <button class="btn" onclick="openDocument('internacao')">Abrir</button>
              </div>
            </div>
          </div>
          
          <!-- Agendamento -->
          <div id="agendamento" class="tab-content">
            <div class="tab-header">
              <h2>Agendamento de Consultas</h2>
              <div class="tab-actions">
                <button class="btn" onclick="newAppointment()"><i class="fas fa-plus"></i> Nova Consulta</button>
              </div>
            </div>
            
            <div class="calendar-container">
              <div class="calendar-header">
                <div class="calendar-nav">
                  <button onclick="changeMonth(-1)"><i class="fas fa-chevron-left"></i></button>
                </div>
                <h3 id="currentMonth">Junho 2023</h3>
                <div class="calendar-nav">
                  <button onclick="changeMonth(1)"><i class="fas fa-chevron-right"></i></button>
                </div>
              </div>
              
              <div class="calendar-grid">
                <div class="calendar-day">Dom</div>
                <div class="calendar-day">Seg</div>
                <div class="calendar-day">Ter</div>
                <div class="calendar-day">Qua</div>
                <div class="calendar-day">Qui</div>
                <div class="calendar-day">Sex</div>
                <div class="calendar-day">Sáb</div>
              </div>
              
              <div id="calendarDates" class="calendar-dates">
                <!-- Datas serão inseridas aqui pelo JavaScript -->
              </div>
            </div>
            
            <div class="appointment-list">
              <h3 style="margin-bottom: 20px;">Consultas Agendadas</h3>
              
              <div class="appointment-item">
                <div class="appointment-info">
                  <h4>Maria Silva</h4>
                  <p>Consulta de rotina - Geriatria</p>
                </div>
                <div class="appointment-time">
                  10:00 - 10:40
                </div>
                <div class="appointment-status status-confirmed">
                  Confirmada
                </div>
              </div>
              
              <div class="appointment-item">
                <div class="appointment-info">
                  <h4>João Santos</h4>
                  <p>Avaliação de memória</p>
                </div>
                <div class="appointment-time">
                  14:30 - 15:15
                </div>
                <div class="appointment-status status-scheduled">
                  Agendada
                </div>
              </div>
            </div>
          </div>
          
          <!-- Solicitar Exames -->
          <div id="exames" class="tab-content">
            <div class="tab-header">
              <h2>Solicitação de Exames</h2>
              <div class="tab-actions">
                <button class="btn" onclick="saveExams()"><i class="fas fa-save"></i> Salvar</button>
                <button class="btn" onclick="printExams()"><i class="fas fa-print"></i> Imprimir</button>
              </div>
            </div>
            
            <div id="alertNoPatientExames" class="no-patient-alert" style="display: none;">
              <i class="fas fa-exclamation-triangle"></i> Nenhum paciente selecionado. Selecione um paciente na aba "Dashboard" para solicitar exames.
            </div>
            
            <div id="examesContent">
              <div class="form-group">
                <label for="examType">Tipo de Exame</label>
                <select id="examType" class="form-control">
                  <option value="laboratorial">Laboratorial</option>
                  <option value="imagem">Imagem</option>
                  <option value="funcional">Funcional</option>
                  <option value="outros">Outros</option>
                </select>
              </div>
              
              <div class="form-group">
                <label for="examInput">Exames Solicitados</label>
                <div style="display: flex; gap: 10px;">
                  <input type="text" id="examInput" class="form-control" placeholder="Ex: Hemograma completo, Glicemia...">
                  <button type="button" class="btn" onclick="addExam()"><i class="fas fa-plus"></i> Adicionar</button>
                </div>
              </div>
              
              <div class="form-group">
                <label>Exames Selecionados</label>
                <ul id="examList" style="background: var(--light); padding: 15px; border-radius: var(--border-radius);">
                  <!-- Exames aparecerão aqui -->
                </ul>
              </div>
              
              <div class="form-group">
                <label for="examInstructions">Instruções Especiais</label>
                <textarea id="examInstructions" class="form-control" rows="3" placeholder="Instruções para preparo ou realização dos exames..."></textarea>
              </div>
            </div>
          </div>

          <!-- Painel de Debug -->
          <div class="debug-panel">
            <h4>🔧 Debug do Sistema</h4>
            <button class="btn" onclick="debugSistema()" style="padding: 5px 10px; font-size: 0.8rem; margin-bottom: 10px;">
              <i class="fas fa-bug"></i> Verificar Dados
            </button>
            <div id="debugOutput"></div>
          </div>
        </main>
      </div>
    </div>
  </section>

  <script>
    // ===== VERIFICAÇÃO DE LOGIN - ÁREA MÉDICA =====
    (function() {
        // Verificar se já está logado (tanto pelo login geral quanto interno)
        const usuarioLogado = JSON.parse(localStorage.getItem('usuarioLogado'));
        
        // Se estiver logado como médico pelo sistema geral
        if (usuarioLogado && usuarioLogado.area === 'medico') {
            // Esconder login e mostrar área médica
            document.getElementById('loginArea').style.display = 'none';
            document.getElementById('medicalArea').style.display = 'block';
            
            // Atualizar nome do médico se disponível
            if (usuarioLogado.nome) {
                document.getElementById('medicName').textContent = usuarioLogado.nome;
                document.getElementById('currentDoctorName').textContent = usuarioLogado.nome;
            }
            
            // Inicializar componentes da área médica
            initCIDSearch();
            initCalendar();
            setupTabNavigation();
            carregarAgendamentosDoDia();
            return;
        }
        
        // Se não está logado, mostrar tela de login
        document.getElementById('loginArea').style.display = 'block';
        document.getElementById('medicalArea').style.display = 'none';
    })();

    // ===== SISTEMA DE LOGIN MÉDICO (para acesso direto) =====
    function loginMed() {
      const usuario = document.getElementById('med-user').value;
      const senha = document.getElementById('med-pass').value;
      
      // Credenciais de teste (compatíveis com o login-geral.html)
      if (usuario === 'medico' && senha === 'medico123') {
          // Salvar informações de login no mesmo formato do login-geral
          const usuarioLogado = {
              area: 'medico',
              usuario: usuario,
              nome: 'Dr. Silva',
              loginTime: new Date().toISOString()
          };
          localStorage.setItem('usuarioLogado', JSON.stringify(usuarioLogado));
          
          // Esconder login e mostrar área médica
          document.getElementById('loginArea').style.display = 'none';
          document.getElementById('medicalArea').style.display = 'block';
          
          // Inicializar componentes
          initCIDSearch();
          initCalendar();
          setupTabNavigation();
          carregarAgendamentosDoDia();
          
          // Esconder mensagem de erro se estiver visível
          document.getElementById('loginError').style.display = 'none';
      } else {
          // Mostrar mensagem de erro
          document.getElementById('loginError').style.display = 'block';
      }
    }

    // ===== FUNÇÃO DE LOGOUT =====
    function sairMedico() {
        if (confirm('Deseja realmente sair da área médica?')) {
            localStorage.removeItem('usuarioLogado');
            // Redirecionar para login geral
            window.location.href = 'login-geral.html';
        }
    }

    // ===== SISTEMA PRINCIPAL =====
    let currentAppointment = null;
    let medications = [];
    let exams = [];
    let appointments = [];
    let selectedCids = [];
    let selectedCidsAtestado = [];
    
    // Base de dados de CID-10
    const cidData = [
      { code: "A00", description: "Cólera" },
      { code: "A01", description: "Febres tifóide e paratifóide" },
      { code: "A02", description: "Outras infecções por Salmonella" },
      { code: "I10", description: "Hipertensão essencial (primária)" },
      { code: "I11", description: "Doença cardíaca hipertensiva" },
      { code: "I20", description: "Angina pectoris" },
      { code: "I21", description: "Infarto agudo do miocárdio" },
      { code: "I25", description: "Doença isquêmica crônica do coração" },
      { code: "E10", description: "Diabetes mellitus insulinodependente" },
      { code: "E11", description: "Diabetes mellitus não-insulinodependente" },
      { code: "E66", description: "Obesidade" },
      { code: "F00", description: "Demência na doença de Alzheimer" },
      { code: "F01", description: "Demência vascular" },
      { code: "F03", description: "Demência não especificada" },
      { code: "F10", description: "Transtornos mentais devido ao uso de álcool" },
      { code: "G20", description: "Doença de Parkinson" },
      { code: "G30", description: "Doença de Alzheimer" },
      { code: "J45", description: "Asma" },
      { code: "J44", description: "Outras doenças pulmonares obstrutivas crônicas" },
      { code: "M15", description: "Poliartrose" },
      { code: "M16", description: "Coxartrose (artrose do quadril)" },
      { code: "M17", description: "Gonartrose (artrose do joelho)" },
      { code: "M19", description: "Outras artroses" },
      { code: "N18", description: "Doença renal crônica" },
      { code: "N39", description: "Outros transtornos do sistema urinário" },
      { code: "R05", description: "Tosse" },
      { code: "R06", description: "Anormalidades da respiração" },
      { code: "R53", description: "Mal-estar e fadiga" },
      { code: "Z00", description: "Exame geral de rotina" }
    ];

    // Modelos de atestados
    const certModels = {
      modelo1: `Atesto que {{nome}}, portador(a) do CPF {{cpf}}, esteve sob meus cuidados médicos e necessita de afastamento de suas atividades laborais por {{dias}} dias, a partir da data presente.{{cid}}`,
      
      modelo2: `Atesto que {{nome}}, portador(a) do CPF {{cpf}}, encontra-se apto(a) para a prática de atividades físicas, não apresentando contraindicações médicas no momento deste exame.{{cid}}`,
      
      modelo3: `Atesto para os devidos fins que {{nome}}, portador(a) do CPF {{cpf}}, esteve presente em consulta médica em nosso serviço no day {{data}}, no período das {{horaInicio}} às {{horaFim}}.{{cid}}`,
      
      modelo4: `Atesto que {{nome}}, portador(a) do CPF {{cpf}}, necessita de acompanhante {{acompanhante}} para consultas e exames médicos devido à sua condição de saúde.{{cid}}`
    };
    
    // Navegação por abas
    function setupTabNavigation() {
      const tabs = document.querySelectorAll('.medical-tab');
      
      tabs.forEach(tab => {
        tab.addEventListener('click', function(e) {
          e.preventDefault();
          
          // Remover classe active de todas as abas
          tabs.forEach(t => t.classList.remove('active'));
          document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
          
          // Adicionar classe active à aba clicada
          this.classList.add('active');
          
          // Mostrar conteúdo correspondente
          const tabId = this.getAttribute('data-tab');
          document.getElementById(tabId).classList.add('active');
          
          // Verificar se há paciente selecionado nas abas que precisam
          if (tabId === 'evolucao') {
            verificarPacienteSelecionadoEvolucao();
          } else if (tabId === 'medicacao') {
            verificarPacienteSelecionadoMedicacao();
          } else if (tabId === 'atestados') {
            verificarPacienteSelecionadoAtestados();
          } else if (tabId === 'exames') {
            verificarPacienteSelecionadoExames();
          } else if (tabId === 'dashboard') {
            carregarAgendamentosDoDia();
          }
        });
      });
    }
    
    // Carregar agendamentos do dia
    function carregarAgendamentosDoDia() {
      const hoje = new Date().toISOString().split('T')[0];
      const agendamentos = JSON.parse(localStorage.getItem('geriatria_agendamentos')) || [];
      const pacientes = JSON.parse(localStorage.getItem('geriatria_pacientes')) || [];
      const triagens = JSON.parse(localStorage.getItem('geriatria_triagens')) || [];
      
      console.log('🔍 Buscando agendamentos para hoje:', hoje);
      console.log('📋 Todos os agendamentos:', agendamentos);
      
      // Filtrar agendamentos de hoje
      const agendamentosHoje = agendamentos.filter(ag => {
        return ag.data === hoje && ag.status !== 'finalizado';
      });
      
      console.log('✅ Agendamentos de hoje:', agendamentosHoje);
      
      // Atualizar contadores
      document.getElementById('agendamentosCount').textContent = agendamentosHoje.length;
      document.getElementById('totalAgendamentosHoje').textContent = `${agendamentosHoje.length} agendamentos`;
      
      const emAtendimento = agendamentosHoje.filter(ag => ag.status === 'em_atendimento').length;
      document.getElementById('atendimentosCount').textContent = emAtendimento;
      document.getElementById('totalAtendimentos').textContent = `${emAtendimento} pacientes`;
      
      // Renderizar agendamentos
      const container = document.getElementById('agendamentosDoDia');
      
      if (agendamentosHoje.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <i class="fas fa-calendar-times"></i>
            <h3>Nenhum agendamento para hoje</h3>
            <p>Não há consultas agendadas para o dia de hoje.</p>
            <p><strong>Clique em "Criar Dados de Teste" para gerar pacientes de exemplo.</strong></p>
          </div>
        `;
        return;
      }
      
      container.innerHTML = '';
      
      agendamentosHoje.forEach(agendamento => {
        const paciente = pacientes.find(p => p.id == agendamento.pacienteId) || {};
        
        // Buscar triagem de forma mais robusta
        const triagem = triagens.find(t => {
          if (t.agendamentoId === agendamento.id) return true;
          if (t.pacienteId == agendamento.pacienteId) return true;
          if (t.pacienteNome && agendamento.pacienteNome && 
              t.pacienteNome === agendamento.pacienteNome) return true;
          return false;
        });
        
        const card = document.createElement('div');
        card.className = `agendamento-card ${triagem ? `prioridade-${triagem.prioridade}` : ''}`;
        
        card.innerHTML = `
          <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px;">
            <h4>${agendamento.pacienteNome || paciente.nome || 'Paciente'}</h4>
            <span class="badge ${getStatusBadgeClass(agendamento.status)}">${getStatusText(agendamento.status)}</span>
          </div>
          <p><i class="fas fa-clock"></i> ${agendamento.hora}</p>
          <p><i class="fas fa-user-md"></i> ${agendamento.medico || 'Dr. Silva'}</p>
          ${triagem ? `<p><i class="fas fa-thermometer-half"></i> Prioridade: <strong>${triagem.prioridade}</strong></p>` : ''}
          ${triagem ? `<p><i class="fas fa-heartbeat"></i> PA: ${triagem.pressaoSistolica}/${triagem.pressaoDiastolica} | FC: ${triagem.batimentosCardiacos}</p>` : ''}
          <div class="agendamento-actions">
            ${agendamento.status === 'agendado' ? `<button class="btn" onclick="iniciarAtendimento('${agendamento.id}')"><i class="fas fa-play"></i> Iniciar</button>` : ''}
            ${agendamento.status === 'em_atendimento' ? `<button class="btn btn-success" onclick="continuarAtendimento('${agendamento.id}')"><i class="fas fa-stethoscope"></i> Continuar</button>` : ''}
            <button class="btn" onclick="verDetalhesAgendamento('${agendamento.id}')"><i class="fas fa-info-circle"></i> Detalhes</button>
          </div>
        `;
        
        container.appendChild(card);
      });
      
      // Carregar pacientes em atendimento
      carregarPacientesEmAtendimento();
    }
    
    // Criar dados de demonstração
    function criarDadosDemonstracao() {
      const hoje = new Date().toISOString().split('T')[0];
      
      // Criar paciente de demonstração
      const pacienteDemo = {
        id: 'demo-001',
        nome: 'Maria Silva',
        cpf: '123.456.789-00',
        dataNascimento: '1948-05-15',
        telefone: '(11) 99999-9999',
        endereco: 'Rua das Flores, 123 - São Paulo/SP',
        escolaridade: '8 anos',
        alergias: 'Penicilina',
        comorbidades: 'Hipertensão, Diabetes'
      };
      
      // Criar agendamento de demonstração
      const agendamentoDemo = {
        id: 'agd-' + Date.now(),
        pacienteId: 'demo-001',
        pacienteNome: 'Maria Silva',
        pacienteCPF: '123.456.789-00',
        medico: 'Dr. Silva',
        data: hoje,
        hora: '10:00',
        status: 'agendado',
        tipo: 'Consulta de rotina'
      };
      
      // Criar triagem de demonstração
      const triagemDemo = {
        id: 'trg-' + Date.now(),
        agendamentoId: agendamentoDemo.id,
        pacienteId: 'demo-001',
        pacienteNome: 'Maria Silva',
        queixaPrincipal: 'Dor articular difusa há 3 meses',
        pressaoSistolica: '140',
        pressaoDiastolica: '90',
        batimentosCardiacos: '72',
        temperatura: '36.5',
        saturacaoOxigenio: '98',
        peso: '65',
        altura: '1.60',
        imc: '25.4',
        glicemia: '110',
        prioridade: 'media',
        observacoes: 'Paciente relata piora progressiva da dor'
      };
      
      // Salvar no localStorage
      const pacientes = JSON.parse(localStorage.getItem('geriatria_pacientes')) || [];
      if (!pacientes.find(p => p.id === 'demo-001')) {
        pacientes.push(pacienteDemo);
      }
      localStorage.setItem('geriatria_pacientes', JSON.stringify(pacientes));
      
      const agendamentos = JSON.parse(localStorage.getItem('geriatria_agendamentos')) || [];
      agendamentos.push(agendamentoDemo);
      localStorage.setItem('geriatria_agendamentos', JSON.stringify(agendamentos));
      
      const triagens = JSON.parse(localStorage.getItem('geriatria_triagens')) || [];
      triagens.push(triagemDemo);
      localStorage.setItem('geriatria_triagens', JSON.stringify(triagens));
      
      showAlert('Dados de demonstração criados com sucesso! Agora você pode iniciar o atendimento.', 'success');
      
      // Recarregar agendamentos
      carregarAgendamentosDoDia();
    }
    
    // Restante do código JavaScript permanece igual...
    // [Todo o restante do código JavaScript das funções anteriores]
    
    // Inicialização quando a área médica é carregada
    document.addEventListener('DOMContentLoaded', function() {
      // Só inicializar se o usuário estiver logado
      const usuarioLogado = JSON.parse(localStorage.getItem('usuarioLogado'));
      if (usuarioLogado && usuarioLogado.area === 'medico') {
        initCIDSearch();
        initCalendar();
        setupTabNavigation();
        carregarAgendamentosDoDia();
      }
    });

    // [Incluir aqui todas as outras funções do sistema médico...]
  </script>
</body>
</html>
